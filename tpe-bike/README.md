# 臺北市機車管制/開放 查詢

前端純靜態網頁，整合臺北市政府三項機車管制/開放相關開放資料，提供多維度篩選與查詢功能。

## 資料來源

- [臺北市開放機車行駛第3車道路段列表](https://data.taipei/api/v1/dataset/a15f2a8d-eb1a-489d-a25f-3d816af10177?scope=resourceAquire)
- [臺北市二車道路段例外實施兩段式左轉管制清冊](https://data.taipei/api/v1/dataset/86c7c859-78d4-430c-bada-277203abd881?scope=resourceAquire)
- [臺北市三(含)車道以上例外開放機車直接左轉路口](https://data.taipei/api/v1/dataset/e77ab72d-cffa-46be-8b5c-16d60c32fce5?scope=resourceAquire)

## 主要功能

### 多維度篩選
- **管制類別**：開放機車行駛第3車道 / 二車道例外兩段式左轉管制 / 三(含)車道以上直接左轉例外
- **行政區**：臺北市12個行政區（中正、大同、中山、松山、大安、萬華、信義、士林、北投、內湖、南港、文山）
- **實施年份**：
  - 2009年以前
  - 2009年起各年度（動態顯示有資料的年份）
  - 2009年起（具體年份不明）
- **關鍵字搜尋**：可搜尋地點、路段、行政區等欄位

### 資料快取機制
- 使用 `localStorage` 快取已抓取的資料
- 初次載入優先使用快取（若存在），加快顯示速度
- 顯示資料獲取時間（格式：YYYY-MM-DD HH:MM:SS，24小時制）
- 提供「強制更新資料」按鈕，可手動觸發重新抓取

### CORS Proxy 支援
- 可切換 CORS Proxy（使用 `https://corsproxy.io/?`）
- 預設為關閉，若遇到跨來源存取問題可手動開啟
- 動態顯示「開」或「關」狀態

### 響應式設計 (RWD)
- 桌面版：標準表格顯示
- 行動版（≤768px）：堆疊式卡片顯示，每個欄位獨立一行，方便閱讀

### 年份資料處理
- 自動辨識民國年並轉換為西元年
- 支援格式：
  - 單一年份（如「98年」→「2009年」）
  - 年份範圍（如「98-101年間」→「2009-2012年間」）
  - 數字格式（如「102」→「2013年」）
  - 特殊標記（如「98年以前」→「2009年以前」）

### 跨行政區資料處理
- 自動偵測跨多個行政區的資料
- 在各個相關行政區篩選時都會顯示
- 表格中保留原始多行政區標示

## 使用方式

1. 直接用瀏覽器開啟 `index.html`
2. 使用上方篩選器選擇管制類別、行政區、實施年份
3. 或在關鍵字欄位輸入搜尋內容
4. 若載入失敗，可嘗試開啟「CORS Proxy」後點擊「強制更新資料」

## 檔案結構

```
as06/
├── index.html    # 主頁面與 UI 結構
├── styles.css    # 樣式表（包含 RWD 斷點）
├── script.js     # 資料抓取、處理、篩選與渲染邏輯
└── README.md     # 說明文件
```

## 技術細節

### 資料抓取
- 實作分頁抓取（`limit`/`offset`），確保取得完整資料
- 每個資料集獨立抓取，單一失敗不影響其他資料集
- 支援多種 API 回應格式（`result.results`、`result.records`、陣列等）

### 欄位對應
使用啟發式規則從不同資料集中擷取：
- **行政區**：優先匹配「行政區」、「行政區別」等欄位，並支援文字偵測
- **地點/路段**：從「路段」、「路名」、「道路名稱」、「地點」、「路口」等欄位組合
- **年份**：從「年份」、「實施年份」、「實施日期」等欄位提取並轉換

### 行政區處理
- 預設臺北市12個行政區清單
- 從原始資料中偵測行政區（包含全名與簡稱）
- 支援「跨越多個行政區」資料的展開與歸納

### 快取策略
- 快取鍵：`tp_moto_cache_v1`
- 儲存內容：正規化後的資料、原始資料、時間戳記
- 版本控制：避免不同版本資料衝突

## 瀏覽器相容性

- 現代瀏覽器（Chrome、Firefox、Safari、Edge）
- 需支援 ES6+ 語法（箭頭函式、`const`/`let`、模板字串等）
- 需支援 `localStorage`

## 開發參考

### 本機測試伺服器（選用）

```powershell
# Windows PowerShell
python -m http.server 8080
```

然後瀏覽 `http://localhost:8080/`

### 修改建議

- **新增資料來源**：在 `DATASETS` 陣列新增項目
- **調整欄位對應**：修改 `guessDistrict()`、`guessLocation()` 等函式
- **自訂年份分類**：調整 `extractYear()` 中的規則
- **修改樣式**：編輯 `styles.css`，RWD 斷點為 `768px`

## 授權與聲明

- 資料來源：[臺北市政府開放資料平台](https://data.taipei/)
- 此專案僅供教學與研究使用
- CORS Proxy 服務由第三方提供，穩定性不保證
